<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width; initial-scale=1.0" name="viewport" /><title>TTC Ridership Analysis Practice | Annideas?</title><meta content="TTC Ridership Analysis Practice | Annideas?" name="title" /><meta content="TTC Ridership Analysis Practice | Annideas?" property="og:title" /><meta content="TTC Ridership Analysis Practice | Annideas?" name="twitter:title" /><meta content="http://annideas.tw/practice/ttc_ridership_analysis/" name="url" /><meta content="http://annideas.tw/practice/ttc_ridership_analysis/" property="og:url" /><meta content="我是陳祐禎 YU CHEN CHEN (Annie)，這個 Blog 記錄著我從教育工作者轉職成 Rails 工程師的心路歷程，歡迎前輩們多多指教，謝謝 :)" name="description" /><meta content="我是陳祐禎 YU CHEN CHEN (Annie)，這個 Blog 記錄著我從教育工作者轉職成 Rails 工程師的心路歷程，歡迎前輩們多多指教，謝謝 :)" property="og:description" /><meta content="我是陳祐禎 YU CHEN CHEN (Annie)，這個 Blog 記錄著我從教育工作者轉職成 Rails 工程師的心路歷程，歡迎前輩們多多指教，謝謝 :)" itemprop="description" /><meta content="我是陳祐禎 YU CHEN CHEN (Annie)，這個 Blog 記錄著我從教育工作者轉職成 Rails 工程師的心路歷程，歡迎前輩們多多指教，謝謝 :)" name="twitter:description" /><meta property="article:published_time" /><meta content="https://www.facebook.com/OtiAnn" property="article:author" /><meta content="article" name="type" /><meta content="article" property="og:type" /><meta content="838413066169349" property="fb:app_id" /><meta content="zh_TW" property="og:locale" /><meta content="Annideas?" itemprop="name" /><meta content="Annideas?" property="og:site_name" /><meta content="http://annideas.tw/images/annie_pic.jpg" property="og:image" /><meta content="@_OtiAnn" name="twitter:site" /><meta content="summary_large_image" name="twitter:card" /><meta content="http://annideas.tw/images/annie_pic.jpg" name="twitter:image" /><meta content="@_OtiAnn" name="twitter:creator" /><meta content="wj4kHYLvvEKT7b_B7Fqp56gRY77ipGuhg11O--1EKXw" name="google-site-verification" /><link href="/stylesheets/practice/ttc_ridership_analysis-c396ea61.css" rel="stylesheet" /><script src="https://d3js.org/d3.v5.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.5.22/dist/vue.js"></script><link href="/images/icon-f0edf780.png" rel="shortcut icon" /></head><body class="practice practice_ttc_ridership_analysis practice_ttc_ridership_analysis_index"><div id="layout"><div id="container"><svg viewbox="0 0 1200 600"></svg></div><div id="app"><div class="slidecontainer"><button class="slider-prev"></button><input class="slider" id="myRange" max="2018" min="1985" type="range" v-model="sliderValue" /><button class="slider-next"></button><div class="year-mark">Year: 2018</div></div></div></div><script>var vm = new Vue({
  el: '#app',
  data:{
    sliderValue: 2018
  }
})

const svg = d3.select('svg');
const svgContainer = d3.select('#container');

const margin = {top: 50, right: 50, bottom: 80, left: 350};
const width = 1200 - margin.left - margin.right;
const height = 600 - margin.top - margin.bottom;

const chart = svg.append('g')
  .attr('transform', `translate(${margin.left}, ${margin.top})`);

const xScale = d3.scaleLinear()
  .range([0, width])
  .domain([0, 225000]);

chart.append('g')
  .attr('transform', `translate(0, ${height})`)
  .call(d3.axisBottom(xScale));

svg
  .append('text')
  .attr('class', 'label')
  .attr('x', -(height / 2) - margin.top)
  .attr('y', margin.top / 2.4)
  .attr('transform', 'rotate(-90)')
  .attr('text-anchor', 'middle')
  .text('Fare Media')

svg.append('text')
  .attr('class', 'label')
  .attr('x', width / 2 + margin.left)
  .attr('y', height + margin.right * 2)
  .attr('text-anchor', 'middle')
  .text('Payment ($)')

svg.append('text')
  .attr('class', 'title')
  .attr('x', width / 2 + margin.left / 2)
  .attr('y', 40)
  .attr('text-anchor', 'middle')
  .text(`TTC Ridership Analysis 2018`)

svg.append('text')
  .attr('class', 'source')
  .attr('x', width + margin.left / 2)
  .attr('y', height + margin.bottom * 1.5)
  .attr('text-anchor', 'start')
  .text('Source: City of Toronto / Open Data, 2018')

d3.json("/files/test_data.json").then(function(data) {
  const sample = data;

  const yScale = d3.scaleBand()
    .range([0, height])
    .domain(sample[0][2018].map((s) => s.fare_media))
    .padding(0.3)

  const makeYLines = () => d3.axisLeft()
    .scale(yScale)

  chart.append('g')
    .call(d3.axisLeft(yScale));

  chart.append('g')
    .attr('class', 'grid')
    .call(makeYLines()
      .tickSize(-width, 0, 0)
      .tickFormat('')
    )

  const barGroups = chart.selectAll()
    .data(sample[0][2018])
    .enter()
    .append('g')

  barGroups
    .append('rect')
    .attr('class', 'bar')
    // .attr('x', (g) => xScale(g.payment))
    .attr('width', (g) => xScale(g.payment))
    .attr('y', (g) => yScale(g.fare_media))
    .attr('height', yScale.bandwidth())

  barGroups 
    .append('text')
    .attr('class', 'fare_media')
    .attr('x', (a) => xScale(a.payment) + 30)
    .attr('y', (a) => yScale(a.fare_media) + yScale.bandwidth() / 1.5)
    .attr('text-anchor', 'middle')
    .text((a) => `$${d3.format(",")(a.payment)}`)

  // ** Update data section (Called from the onclick)
  function updateData() {
    svg.selectAll("rect.bar").remove()
    svg.selectAll("text.fare_media").remove()
    // Get the data again
    const barGroups = chart.selectAll()
      .data(sample[0][vm.sliderValue])
      .enter()

    barGroups
      .append('rect')
      .attr('class', 'bar')
      // .transition()
      // .duration(500)
      .attr('width', (g) => xScale(g.payment))
      .attr('y', (g) => yScale(g.fare_media))
      .attr('height', yScale.bandwidth())

    barGroups
      .append('text')
      .attr('class', 'fare_media')
      // .transition()
      // .duration(500)
      .attr('x', (a) => xScale(a.payment) + 30)
      .attr('y', (a) => yScale(a.fare_media) + yScale.bandwidth() / 1.5)
      .attr('text-anchor', 'middle')
      .text((a) => `$${d3.format(",")(a.payment)}`)

    d3.select("text.title").text(`TTC Ridership Analysis ${vm.sliderValue}`);
    d3.selectAll('.year-mark').remove()
    d3.select(".slidecontainer").append('div')
      .attr('class', 'year-mark')
      .text(`Year: ${vm.sliderValue}`)
  }


  d3.select('#myRange').on('change', function() {
    updateData();
  });

  d3.select('button.slider-prev').on('click', function() {
    if (vm.sliderValue > 1985) {
      vm.sliderValue -= 1;
      updateData();
    }
  });

  d3.select('button.slider-next').on('click', function() {
    if (vm.sliderValue < 2018) {
      vm.sliderValue = parseInt(vm.sliderValue) + 1;
      updateData();
    }
  });
});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51807616-2', 'auto');
ga('send', 'pageview');</script></body></html>