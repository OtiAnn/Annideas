<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width; initial-scale=1.0" name="viewport" /><title>TTC Ridership Analysis 1985 - 2018 Practice | Annideas?</title><meta content="TTC Ridership Analysis 1985 - 2018 Practice | Annideas?" name="title" /><meta content="TTC Ridership Analysis 1985 - 2018 Practice | Annideas?" property="og:title" /><meta content="TTC Ridership Analysis 1985 - 2018 Practice | Annideas?" name="twitter:title" /><meta content="http://annideas.tw/practice/ttc_ridership_analysis/" name="url" /><meta content="http://annideas.tw/practice/ttc_ridership_analysis/" property="og:url" /><meta content="Practice | An interactive bar chart showing the TTC Ridership from 1985 to 2018 | Annideas?" name="description" /><meta content="Practice | An interactive bar chart showing the TTC Ridership from 1985 to 2018 | Annideas?" property="og:description" /><meta content="Practice | An interactive bar chart showing the TTC Ridership from 1985 to 2018 | Annideas?" itemprop="description" /><meta content="Practice | An interactive bar chart showing the TTC Ridership from 1985 to 2018 | Annideas?" name="twitter:description" /><meta content="website" name="type" /><meta content="website" property="og:type" /><meta content="838413066169349" property="fb:app_id" /><meta content="zh_TW" property="og:locale" /><meta content="Annideas?" itemprop="name" /><meta content="Annideas?" property="og:site_name" /><meta content="http://annideas.tw/images/annie_pic.jpg" property="og:image" /><meta content="@_OtiAnn" name="twitter:site" /><meta content="summary_large_image" name="twitter:card" /><meta content="http://annideas.tw/images/annie_pic.jpg" name="twitter:image" /><meta content="@_OtiAnn" name="twitter:creator" /><meta content="wj4kHYLvvEKT7b_B7Fqp56gRY77ipGuhg11O--1EKXw" name="google-site-verification" /><link href="/stylesheets/application-8ef261f0.css" rel="stylesheet" /><script src="/javascripts/jquery-3.2.1.min-aa407c6a.js"></script><script src="/javascripts/application-fb8733fc.js"></script><link href="/stylesheets/practice/ttc_ridership_analysis-53e97f96.css" rel="stylesheet" /><script src="https://d3js.org/d3.v5.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.5.22/dist/vue.js"></script><link href="/images/icon-f0edf780.png" rel="shortcut icon" /></head><body class="practice practice_ttc_ridership_analysis practice_ttc_ridership_analysis_index"><div class="wrapper"><a href="/" class="go_home_logo"><img src="/images/go_home_logo-55ba1e01.png" alt="Go home logo" /><h1 class="title">Annideas?</h1></a><div class="container"><div class="articleContent"><div class="articleContent-category"><a href="/practice">Practice</a></div><div class="articleContent-title">TTC Ridership Analysis 1985 - 2018</div><div class="articleContent-date tool">Vue.js + D3.js v5</div><div class="articleContent-article tp-in-content"><blockquote>2019/01/26 Note:<br />Issue 1: Still not working on Mobile and Firefox<br />Issue 2: Should enhance the draggable bar and the transtion while year is changing </blockquote><div id="layout"><div id="container"><svg viewbox="0 0 1200 700"></svg></div><div id="app"><div class="slidecontainer"><button class="slider-prev"></button><input class="slider" id="myRange" max="2018" min="1985" type="range" v-model="sliderValue" /><button class="slider-next"></button><div class="year-block"><div attr-year="1985" class="year-mark ">1985</div><div attr-year="1986" class="year-mark ">1986</div><div attr-year="1987" class="year-mark ">1987</div><div attr-year="1988" class="year-mark ">1988</div><div attr-year="1989" class="year-mark ">1989</div><div attr-year="1990" class="year-mark ">1990</div><div attr-year="1991" class="year-mark ">1991</div><div attr-year="1992" class="year-mark ">1992</div><div attr-year="1993" class="year-mark ">1993</div><div attr-year="1994" class="year-mark ">1994</div><div attr-year="1995" class="year-mark ">1995</div><div attr-year="1996" class="year-mark ">1996</div><div attr-year="1997" class="year-mark ">1997</div><div attr-year="1998" class="year-mark ">1998</div><div attr-year="1999" class="year-mark ">1999</div><div attr-year="2000" class="year-mark ">2000</div><div attr-year="2001" class="year-mark ">2001</div><div attr-year="2002" class="year-mark ">2002</div><div attr-year="2003" class="year-mark ">2003</div><div attr-year="2004" class="year-mark ">2004</div><div attr-year="2005" class="year-mark ">2005</div><div attr-year="2006" class="year-mark ">2006</div><div attr-year="2007" class="year-mark ">2007</div><div attr-year="2008" class="year-mark ">2008</div><div attr-year="2009" class="year-mark ">2009</div><div attr-year="2010" class="year-mark ">2010</div><div attr-year="2011" class="year-mark ">2011</div><div attr-year="2012" class="year-mark ">2012</div><div attr-year="2013" class="year-mark ">2013</div><div attr-year="2014" class="year-mark ">2014</div><div attr-year="2015" class="year-mark ">2015</div><div attr-year="2016" class="year-mark ">2016</div><div attr-year="2017" class="year-mark ">2017</div><div attr-year="2018" class="year-mark select">2018</div></div></div></div></div><script>var vm = new Vue({
  el: '#app',
  data:{
    sliderValue: 2018
  }
})

const svg = d3.select('svg');

const margin = {top: 80, right: 50, bottom: 160, left: 400};
const width = 1200 - margin.left - margin.right;
const height = 700 - margin.top - margin.bottom;

const chart = svg.append('g')
  .attr('transform', `translate(${margin.left}, ${margin.top})`);

const xScale = d3.scaleLinear()
  .range([0, width])
  .domain([0, 225000]);

chart.append('g')
  .attr('transform', `translate(0, ${height})`)
  .call(d3.axisBottom(xScale));

svg
  .append('text')
  .attr('class', 'label')
  .attr('x', -(height / 2) - margin.top)
  .attr('y', margin.top / 2.4)
  .attr('transform', 'rotate(-90)')
  .attr('text-anchor', 'middle')
  .text('Fare Media')

svg.append('text')
  .attr('class', 'label')
  .attr('x', width / 2 + margin.left)
  .attr('y', height + margin.right * 2.4)
  .attr('text-anchor', 'middle')
  .text('Payment ($)')

svg.append('text')
  .attr('class', 'title')
  .attr('x', width / 2 + margin.left / 2)
  .attr('y', 40)
  .attr('text-anchor', 'middle')
  .text(`TTC Ridership Analysis 2018`)

svg.append('text')
  .attr('class', 'year')
  .attr('x', -(height) - 165)
  .attr('y', margin.top / 2.4)
  .attr('transform', 'rotate(-90)')
  .attr('text-anchor', 'middle')
  .text('Year')

svg.append('text')
  .attr('class', 'source')
  .attr('x', width + margin.left/2.5)
  .attr('y', height + margin.bottom * 1.4)
  .attr('text-anchor', 'start')
  .text('Source: City of Toronto / Open Data, 2018')

d3.json("/files/test_data.json").then(function(data) {
  const sample = data;

  const yScale = d3.scaleBand()
    .range([0, height])
    .domain(sample[0][2018].map((s) => s.fare_media))
    .padding(0.3)

  const makeYLines = () => d3.axisLeft()
    .scale(yScale)

  chart.append('g')
    .call(d3.axisLeft(yScale));

  chart.append('g')
    .attr('class', 'grid')
    .call(makeYLines()
      .tickSize(-width, 0, 0)
      .tickFormat('')
    )

  const barGroups = chart.selectAll()
    .data(sample[0][2018])
    .enter()
    .append('g')

  barGroups
    .append('rect')
    .attr('class', 'bar')
    // .attr('x', (g) => xScale(g.payment))
    .attr('width', (g) => xScale(g.payment))
    .attr('y', (g) => yScale(g.fare_media))
    .attr('height', yScale.bandwidth())

  barGroups 
    .append('text')
    .attr('class', 'fare_media')
    .attr('x', (a) => xScale(a.payment) + 30)
    .attr('y', (a) => yScale(a.fare_media) + yScale.bandwidth() / 1.5)
    .attr('text-anchor', 'middle')
    .text((a) => `$${d3.format(",")(a.payment)}`)

  function updateData() {
    chart.selectAll('rect.bar')
      .data(sample[0][vm.sliderValue])
      .attr('y', (g) => yScale(g.fare_media))
      .attr('height', yScale.bandwidth())
      .transition()
      .duration(500)
      .attr('width', (g) => xScale(g.payment))

    chart
      .selectAll('text.fare_media')
      .data(sample[0][vm.sliderValue])
      .attr('y', (a) => yScale(a.fare_media) + yScale.bandwidth() / 1.5)
      .attr('text-anchor', 'middle')
      .text((a) => `$${d3.format(",")(a.payment)}`)
      .transition()
      .duration(500)
      .attr('x', (a) => xScale(a.payment) + 30)

    d3.select("text.title").text(`TTC Ridership Analysis ${vm.sliderValue}`);
    d3.select(".year-mark.select").classed("select", false);
    d3.select("[attr-year='" + vm.sliderValue + "']").classed("select", true);
  }

  d3.select('#myRange').on('change', function() {
    updateData();
  });

  d3.select('button.slider-prev').on('click', function() {
    if (vm.sliderValue > 1985) {
      vm.sliderValue -= 1;
      updateData();
    }
  });

  d3.select('button.slider-next').on('click', function() {
    if (vm.sliderValue < 2018) {
      vm.sliderValue = parseInt(vm.sliderValue) + 1;
      updateData();
    }
  });
});</script></div><div class="articleContent-social"><div id="fb-root"></div><script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1&appId=838413066169349&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><div class="fb-like" data-action="like" data-href="http://annideas.tw/practice/ttc_ridership_analysis/" data-layout="button_count" data-share="true" data-show-faces="true" data-size="small" data-width="700px"></div></div><div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'otiannie5';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div></div><div class="menu_icon_block" data-show-menu=""><div class="menu_icon"></div></div><div class="mask" data-hide-menu=""></div><nav><img class="close" data-hide-menu="true" src="/images/cross-e391fcc8.svg" alt="Cross" /><div class="avatar"><a href="/"><img src="/images/annie_pic-a20039dc.jpg" alt="Annie pic" /></a></div><div class="social_link"><a href="/en/resume"><img class="resume" src="/images/me-123f788f.svg" alt="Me" /></a><a href="https://www.facebook.com/OtiAnn" target="_blank"><img class="facebook" src="/images/facebook-368929ba.svg" alt="Facebook" /></a><a href="https://www.linkedin.com/in/yccannie" target="_blank"><img class="linkedin" src="/images/linkedin-2ba621d9.svg" alt="Linkedin" /></a></div><div class="desc_block"><div class="name">Yu-Chen (Annie) Chen</div><div class="description">2+ years Web Developer, 7+ years Instructor</div></div><ul class="catgory_list"><li><a href="/categories/生活/" class="life">Life (3)</a></li><li><a href="/categories/學習/" class="edu">Learning (4)</a></li><li><a href="/categories/開發/" class="dev">Coding (7)</a></li><li><a href="/ironman7">Article (30)</a></li><li><a href="/categories/楓葉國紀錄/" class="maple">Canada (2)</a></li><li class="practice_link"><a href="/practice">Practice (1)<img class="pacman" src="/images/pacman-43d7b83d.svg" alt="Pacman" /></a></li></ul></nav><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51807616-2', 'auto');
ga('send', 'pageview');</script></div></body></html>